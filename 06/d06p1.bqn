#! /usr/bin/env -S bqn -f

Load â† >âˆ˜â€¢FLines
Solve â† { ğ•Š map:
  âŸ¨Â·, ncâŸ© â† â‰¢map
  igrid â† (âŠ¢â¥Šâ†•âˆ˜(Ã—Â´))âˆ˜â‰¢ map
  obs â† '#'=map
  rots â† âŸ¨â‰, âŒ½Ë˜, âŒ½Ë˜âˆ˜â‰, âŠ¢âŸ©
  MkDestLine â† 0âŠ¸â‰ â—¶âŠ£â€¿âŠ¢` Â¯1âŠ¸Â»âŠ¸Ã—
  dests â† {â¥Š obs MkDestLineË˜âŒ¾ğ• igrid}Â¨ rots
  Travel â† { âŸ¨i, dâŸ©: âŸ¨iâŠ‘dâŠ‘dests, 4|1+dâŸ© }
  Path â† {
    ğ•© < 0 ? ğ•¨ğ•Š|ğ•© ; ğ•© < ğ•¨ ? ğ•©ğ•Šğ•¨ ;
    nc â‰¤ ğ•©-ğ•¨ ? ğ•¨ + nc Ã— 0ğ•Š(nc âŒŠâˆ˜Ã·Ëœ ğ•©-ğ•¨) ;
    ğ•¨ + â†•ğ•©Â¬ğ•¨
  }

  visited â† Ã—Â´âˆ˜â‰¢âŠ¸â¥ŠâŸœ0 map
  Step â† { ğ•Š âŸ¨i, Â·âŸ©:
    âŸ¨i1, Â·âŸ© â† x1 â† Travel ğ•©
    visited â†© (1â‰0)âŒ¾((i Path i1)âŠ¸âŠ) visited
    x1
  }

  Step â€¢_while_ (0âŠ¸<âˆ˜âŠ‘) (âŠ‘ â¥ŠâŠ¸âŠâŸœ'^' map)â€¿0

  +Â´ visited
}

â€¢Showâˆ˜Solveâˆ˜LoadÂ¨ â€¢args
