#! /usr/bin/env -S bqn -f

_FP â† { F _ğ•£ x: {F xâ†©ğ•©}â€¢_while_{xâ‰¢ğ•©} F x ; ğ•¨âŠ¸ğ”½ _ğ•£ ğ•©  }

Load â† >âˆ˜â€¢FLines
deltas â† âŸ¨0â€¿1, 1â€¿0, 0â€¿Â¯1, Â¯1â€¿0âŸ©
Solve â† { ğ•Š map:
  âŸ¨nr, ncâŸ© â† mapdim â† â‰¢map
  flatmap â† â¥Šmap
  flatindex â† â†•â‰ flatmap
  Iob â† (0âŠ¸â‰¤ âˆ§Â´âˆ˜âˆ§ <âŸœmapdim)âˆ˜âŠ¢
  CoordIndex â† { râ€¿c: c + r Ã— nr }
  neighbori â† > (â¥Šâ†•mapdim) {Iobâ—¶Â¯1â€¿CoordIndex ğ•¨+ğ•©}âŒœ deltas
  selfneighbori â† flatindex âˆ¾â‰0â€¿1 neighbori
  sameplant â† (neighbori â‰¥ 0) âˆ§ (flatmap =âŸœ(âŠâŸœflatmap) neighbori)
  selfsameplant â† 1âŠ¸âˆ¾Ë˜ sameplant
  perimeters â† +Â´Ë˜ Â¬sameplant
  CountCorners â† { sp ğ•Š ni: +Â´ (Â¬sp) âˆ§ (Â¬1âŒ½sp) âˆ¨ (0â€¿0â‰(1âŒ½ni)âŠsameplant) }
  sides â† sameplant CountCornersË˜ neighbori
  RegionCost â† â‰  Ã— +Â´âˆ˜âŠâŸœsides
  Step â† { selfsameplant (âŒŠÂ´ âŠâŸœğ•©âˆ˜/)Ë˜ selfneighbori }

  +Â´ RegionCostÂ¨ âŠ”âŠ Step _FP flatindex
}

â€¢Showâˆ˜Solveâˆ˜LoadÂ¨ â€¢args
