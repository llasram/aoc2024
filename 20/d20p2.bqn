#! /usr/bin/env -S bqn -f

_FP â† { âŠ‘ ((ğ”½â‹ˆâŠ¢)âŠ‘)â€¢_while_(â‰¢Â´) (ğ”½ğ•©)â€¿ğ•© ; ğ•¨âŠ¸ğ”½ _ğ•£ ğ•© }

Load â† >âˆ˜â€¢FLines


moves â† âŸ¨Â«, Â»Ë˜, Â», Â«Ë˜âŸ©
ExpandFringe â† (âˆ¨Â´ <âŠ¸({ğ•ğ•¨}Â¨)âŸœmoves)âŠ¸âˆ§
CostFillStep â† { ğ•Š âŸ¨fringe, cost, mask, nâŸ©:
  mask â‰ â†© fringe
  fringe ExpandFringeâ†© mask
  cost âŒˆâ†© nÃ—fringe
  âŸ¨fringe, cost, mask, n+1âŸ©
}
CostFill â† { mask ğ•Š start:
  # Costs are offset by +1 so that "0" is inaccessible
  1âŠ‘ (CostFillStep)â€¢_while_(âˆ¨Â´âˆ˜â¥ŠâŠ‘) âŸ¨start, start, mask, 2âŸ©
}

CheatSavings â† { baseâ€¿e2costâ€¿s2cost ğ•Š cdist:
  cpad â† 2Ã—cdist
  cwin â† 1+cpad

  âŸ¨PadâŸ© â† { Pad â‡ FË˜ (Fâ† Â»âŸcdist (cpad+â‰ )â†‘âŠ¢) }
  mdol â† +Â´Â¨ | cdist-Ëœ â†•cwinâ€¿cwin
  cmask â† cdistâ‰¥ mdol
  CheatSavings â† âŠ‘âŠ¸{
    0 ğ•Š Â·: 0 ;
    s2cost ğ•Š e2cost: {
      total â† Â¯2+e2cost+mdol+s2cost
      +Â´ â¥Š cmaskâˆ§(e2cost>0)âˆ§(base-100)â‰¥total
    }
  }
  +Â´ â¥Š s2cost CheatSavingsâ‰0â€¿2 cwinâ€¿cwinâ†• Pad e2cost
}

Solve â† { cdists ğ•Š map:
  mask0 â† '#'â‰ map
  epos â† âŠ‘ ('E'âŠ¸= /â—‹â¥Š â†•âˆ˜â‰¢) map

  e2cost â† mask0 CostFill 'E'=map
  s2cost â† mask0 CostFill 'S'=map
  base â† Â¯1+eposâŠ‘s2cost

  âŸ¨base, e2cost, s2costâŸ©âŠ¸CheatSavingsÂ¨ cdists
}

{â€¢ShowÂ¨ 2â€¿20 Solve Load ğ•©}Â¨ â€¢args
